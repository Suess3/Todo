<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meine Todo App</title>
    <style>
        body {
            background-color: #121212;
            color: white;
            font-family: 'Georgia', serif; /* Ähnlich wie IM Fell English */
            display: flex;
            justify-content: center;
            margin: 0;
            padding: 20px;
        }
        .container {
            width: 100%;
            max-width: 500px;
        }
        h1 {
            text-align: center;
            color: #4285F4;
            font-family: sans-serif;
        }
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        input[type="text"] {
            flex-grow: 1;
            background: #333;
            border: 1px solid #555;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
        }
        button {
            background: #4285F4;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background: #3367d6; }
        
        .todo-item {
            background: #1e1e1e;
            padding: 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }
        .todo-text {
            flex-grow: 1;
            margin-left: 15px;
            font-size: 18px;
        }
        .done {
            text-decoration: line-through;
            color: gray;
            opacity: 0.6;
        }
        /* Custom Checkbox Look */
        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .checkbox.checked {
            background-color: #4285F4;
            border-color: #4285F4;
        }
        .delete-btn {
            color: #ff6b6b;
            cursor: pointer;
            padding: 5px;
            margin-left: 10px;
            font-family: sans-serif;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Meine Todos</h1>
    
    <div class="input-group">
        <input type="text" id="todoInput" placeholder="Neue Aufgabe..." onkeypress="handleEnter(event)">
        <button onclick="addTodo()">+</button>
    </div>

    <div id="todoList">
        Lade Daten...
    </div>
</div>

<script type="module">
    // --- FIREBASE IMPORTIEREN ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, updateDoc, doc, deleteDoc, where } 
      from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // --- DEINE KONFIGURATION (HIER MUSST DU GLEICH WAS EINFÜGEN) ---
    const firebaseConfig = {
        // ... HIER GLEICH DEINE DATEN EINFÜGEN ...
    };

    // --- APP STARTEN ---
    let app, db;
    try {
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
    } catch (e) {
        document.getElementById("todoList").innerHTML = "Fehler: Config fehlt!";
        console.error(e);
    }

    // --- DATEN LADEN (Nur von HEUTE und ZUKUNFT) ---
    // Android nutzt Epoch Days. Wir berechnen den heutigen Tag.
    const todayEpoch = Math.floor(Date.now() / 86400000);

    const q = query(
        collection(db, "todos"), 
        where("dateEpochDay", ">=", todayEpoch), // Zeige nur Aufgaben ab heute
        orderBy("dateEpochDay", "asc"),
        orderBy("sortOrder", "asc")
    );
    
    onSnapshot(q, (snapshot) => {
        const listDiv = document.getElementById("todoList");
        listDiv.innerHTML = "";
        
        snapshot.forEach((docSnap) => {
            const todo = docSnap.data();
            renderTodo(listDiv, docSnap.id, todo);
        });
        
        if(snapshot.empty) listDiv.innerHTML = "<div style='text-align:center; color:gray'>Alles erledigt!</div>";
    });

    // --- HILFSFUNKTIONEN ---

    function renderTodo(container, id, todo) {
        const div = document.createElement("div");
        div.className = "todo-item";
        
        // Farbe berechnen (wie in der Android App)
        let colorStyle = "";
        if (!todo.isDone) {
            if (todo.moveCount === 1) colorStyle = "color: #FFFFE6;";
            else if (todo.moveCount === 2) colorStyle = "color: #FFEFE0;";
            else if (todo.moveCount >= 3) colorStyle = "color: #FFEBEB;";
        }

        div.innerHTML = `
            <div class="checkbox ${todo.isDone ? 'checked' : ''}" onclick="toggleTodo('${id}', ${!todo.isDone})">
                ${todo.isDone ? '✓' : ''}
            </div>
            <span class="todo-text ${todo.isDone ? 'done' : ''}" style="${colorStyle}">
                ${todo.text}
            </span>
            <span class="delete-btn" onclick="deleteTodo('${id}')">✕</span>
        `;
        container.appendChild(div);
    }

    // Funktionen global verfügbar machen für HTML onclick
    window.addTodo = async () => {
        const input = document.getElementById("todoInput");
        if (!input.value.trim()) return;

        await addDoc(collection(db, "todos"), {
            text: input.value,
            isDone: false,
            dateEpochDay: todayEpoch, // Immer für "Heute" anlegen
            sortOrder: Date.now(), // Simpler Sort
            moveCount: 0
        });
        input.value = "";
    };

    window.toggleTodo = async (id, newStatus) => {
        await updateDoc(doc(db, "todos", id), { isDone: newStatus });
    };

    window.deleteTodo = async (id) => {
        if(confirm("Löschen?")) {
            await deleteDoc(doc(db, "todos", id));
        }
    };

    window.handleEnter = (e) => {
        if (e.key === "Enter") window.addTodo();
    };

</script>

</body>
</html>